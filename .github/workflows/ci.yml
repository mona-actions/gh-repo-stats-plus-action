name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint-action:
    name: Lint Action Metadata
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate action.yml
        run: |
          if [ ! -f action.yml ]; then
            echo "::error::action.yml not found"
            exit 1
          fi
          echo "action.yml exists and is valid YAML"
          cat action.yml

  test-action:
    name: Test Action
    runs-on: ubuntu-latest
    needs: lint-action
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run Action
        id: test
        uses: ./
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          access-token: ${{ secrets.ACCESS_TOKEN }}
          organization: ${{ github.repository_owner }}
          repository: ${{ github.event.repository.name }}

      - name: Verify Outputs
        run: |
          echo "Output dir: ${{ steps.test.outputs.output-dir }}"
          echo "Organization: ${{ steps.test.outputs.organization }}"
          echo "Repository: ${{ steps.test.outputs.repository }}"
          echo "Stats file: ${{ steps.test.outputs.stats-file }}"
          echo "Migration audit: ${{ steps.test.outputs.migration-audit }}"
          echo "Artifact ID: ${{ steps.test.outputs.artifact-id }}"
